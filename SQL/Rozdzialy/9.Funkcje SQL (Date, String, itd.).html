<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funkcje SQL ‚Äì Data, Tekst, Konwersje</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <h1>Funkcje SQL ‚Äì Data, Tekst, Konwersje Typ√≥w</h1>

    <p>
      SQL ma zestaw ‚Äûnarzƒôdzi‚Äù: <strong>kalendarz</strong> (funkcje daty/czasu), <strong>no≈ºyczki do tekstu</strong> (funkcje ≈Ça≈Ñcuch√≥w)
      i <strong>adaptery</strong> (konwersje typ√≥w). Poni≈ºej praktyczne przyk≈Çady.
    </p>

    <div class="note">
      <strong>Uwaga o r√≥≈ºnicach miƒôdzy silnikami:</strong> Sk≈Çadnia bywa nieco inna w PostgreSQL / MySQL / SQL Server.
      Zaznaczam to w komentarzach, a wyniki tabelaryczne sƒÖ poglƒÖdowe.
    </div>

    <!-- =================== DANE WEJ≈öCIOWE =================== -->
    <details open>
      <summary class="table-title">Dane wej≈õciowe: <code>users</code></summary>
      <table class="db-table">
        <thead><tr><th>id</th><th>first_name</th><th>last_name</th><th>created_at (timestamp)</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>Anna</td><td>Kowalska</td><td>2025-01-05 09:15:00</td></tr>
          <tr><td>2</td><td>Jan</td><td>Nowak</td><td>2025-03-21 14:02:10</td></tr>
          <tr><td>3</td><td>Ola</td><td>Lis</td><td>2024-12-31 23:59:00</td></tr>
        </tbody>
      </table>
    </details>

    <details open>
      <summary class="table-title">Dane wej≈õciowe: <code>products</code></summary>
      <table class="db-table">
        <thead><tr><th>id</th><th>name</th><th>description</th><th>category</th><th>price</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>Telefon</td><td>Nowy telefon z 5G</td><td>Elektronika</td><td>1200.00</td></tr>
          <tr><td>2</td><td>Laptop</td><td>Laptop 15" dla graczy</td><td>Elektronika</td><td>4000.00</td></tr>
          <tr><td>3</td><td>Czajnik</td><td>Czajnik stalowy 1.7L</td><td>Dom</td><td>150.00</td></tr>
        </tbody>
      </table>
    </details>

    <details open>
      <summary class="table-title">Dane wej≈õciowe: <code>sales</code></summary>
      <table class="db-table">
        <thead><tr><th>id</th><th>amount_text (VARCHAR)</th><th>sold_at (timestamp)</th></tr></thead>
        <tbody>
          <tr><td>5001</td><td>1234.5</td><td>2025-01-05 10:30:00</td></tr>
          <tr><td>5002</td><td>89.99</td><td>2025-04-21 16:45:00</td></tr>
        </tbody>
      </table>
    </details>
    <!-- ====================================================== -->

    <!-- =================== DATY I CZAS =================== -->
    <h2>Funkcje daty i czasu</h2>
    <ul>
      <li><code>NOW()</code> ‚Äì bie≈ºƒÖca data i czas (<em>timestamp</em> ‚Äî znacznik czasu),</li>
      <li><code>CURDATE()</code>/<code>CURRENT_DATE</code> ‚Äì sama data, <code>CURTIME()</code>/<code>CURRENT_TIME</code> ‚Äì sam czas,</li>
      <li><code>DATE(expr)</code> / <code>TIME(expr)</code> ‚Äì wyciƒÖga tylko czƒô≈õƒá daty/czasu,</li>
      <li><code>DATE_ADD(d, INTERVAL x unit)</code> / <code>DATE_SUB(...)</code> ‚Äì dodaj/odejmij okres,</li>
      <li><code>DATEDIFF(d1,d2)</code> ‚Äì r√≥≈ºnica dni, <code>EXTRACT(part FROM expr)</code> ‚Äì rok/miesiƒÖc/dzie≈Ñ,</li>
      <li><code>DATE_FORMAT(d, fmt)</code> (MySQL) / <code>TO_CHAR(d, fmt)</code> (Postgres) ‚Äì formatowanie.</li>
    </ul>

    <pre><code class="language-sql">-- üóìÔ∏è PrzeglƒÖd bazowych funkcji daty/czasu (MySQL/PostgreSQL)
SELECT
  NOW()                               AS teraz,         -- bie≈ºƒÖcy timestamp
  DATE(NOW())                         AS tylko_data,    -- czƒô≈õƒá daty
  TIME(NOW())                         AS tylko_czas,    -- czƒô≈õƒá czasu
  DATE_ADD(NOW(), INTERVAL 7 DAY)     AS za_tydzien,    -- +7 dni (MySQL)
  DATEDIFF('2025-05-01','2025-04-21') AS dni_roznicy,   -- 10
  EXTRACT(MONTH FROM NOW())           AS miesiac;       -- numer miesiƒÖca</code></pre>

    <details open>
      <summary class="table-title">Wynik (przyk≈Çadowy, poglƒÖdowy)</summary>
      <table class="db-table">
        <thead><tr><th>teraz</th><th>tylko_data</th><th>tylko_czas</th><th>za_tydzien</th><th>dni_roznicy</th><th>miesiac</th></tr></thead>
        <tbody>
          <tr>
            <td>2025-09-12 11:00:00</td>
            <td>2025-09-12</td>
            <td>11:00:00</td>
            <td>2025-09-19 11:00:00</td>
            <td>10</td>
            <td>9</td>
          </tr>
        </tbody>
      </table>
      <p class="mini">Czasy sƒÖ przyk≈Çadowe (zale≈ºne od systemu/strefy). Liczby i formaty s≈Çu≈ºƒÖ nauce.</p>
    </details>

    <h3>WyciƒÖganie czƒô≈õci daty z kolumny</h3>
    <pre><code class="language-sql">-- üóÇÔ∏è Rozbij timestamp na rok/miesiƒÖc/dzie≈Ñ (uniwersalnie)
SELECT
  id,
  sold_at,
  DATE(sold_at)                         AS tylko_dzien,         -- 2025-01-05
  EXTRACT(YEAR  FROM sold_at)           AS rok,                 -- 2025
  EXTRACT(MONTH FROM sold_at)           AS miesiac,             -- 1
  EXTRACT(DAY   FROM sold_at)           AS dzien                -- 5
FROM sales;</code></pre>

    <details>
      <summary class="table-title">Wynik</summary>
      <table class="db-table">
        <thead><tr><th>id</th><th>sold_at</th><th>tylko_dzien</th><th>rok</th><th>miesiac</th><th>dzien</th></tr></thead>
        <tbody>
          <tr><td>5001</td><td>2025-01-05 10:30:00</td><td>2025-01-05</td><td>2025</td><td>1</td><td>5</td></tr>
          <tr><td>5002</td><td>2025-04-21 16:45:00</td><td>2025-04-21</td><td>2025</td><td>4</td><td>21</td></tr>
        </tbody>
      </table>
    </details>

    <!-- =================== TEKST =================== -->
    <h2>Funkcje manipulacji tekstem</h2>
    <ul>
      <li><code>CONCAT(a,b,...)</code> ‚Äì sklejanie, <code>SUBSTRING(s, start, len)</code> ‚Äì wycinek,</li>
      <li><code>LENGTH(s)</code>/<code>CHAR_LENGTH(s)</code> ‚Äì d≈Çugo≈õƒá, <code>UPPER</code>/<code>LOWER</code> ‚Äì wielko≈õƒá liter,</li>
      <li><code>TRIM(s)</code> ‚Äì usuwa spacje/taby z poczƒÖtku i ko≈Ñca, <code>REPLACE(s, from, to)</code> ‚Äì zamiana.</li>
    </ul>

    <h3>Pe≈Çne imiƒô z dw√≥ch kolumn (users)</h3>
    <pre><code class="language-sql">-- üë§ Sklejenie imienia i nazwiska + ma≈Ça normalizacja
SELECT
  id,                           -- identyfikator
  CONCAT(first_name,' ',last_name)          AS full_name,  -- Anna Kowalska
  UPPER(last_name)                           AS nazwisko_caps,   -- KOWALSKA
  LOWER(first_name)                           AS imie_lower       -- anna
FROM users;</code></pre>

    <details open>
      <summary class="table-title">Wynik</summary>
      <table class="db-table">
        <thead><tr><th>id</th><th>full_name</th><th>nazwisko_caps</th><th>imie_lower</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>Anna Kowalska</td><td>KOWALSKA</td><td>anna</td></tr>
          <tr><td>2</td><td>Jan Nowak</td><td>NOWAK</td><td>jan</td></tr>
          <tr><td>3</td><td>Ola Lis</td><td>LIS</td><td>ola</td></tr>
        </tbody>
      </table>
    </details>

    <h3>Przycinanie i skracanie opisu (products)</h3>
    <pre><code class="language-sql">-- üìù Skr√≥t opisu + zamiana fragmentu + TRIM bia≈Çych znak√≥w
SELECT
  id,
  name,
  SUBSTRING(description,1,12)            AS skrot,                -- pierwsze 12 znak√≥w
  LENGTH(description)                     AS dlugosc,              -- ile znak√≥w
  REPLACE(category,'Elektronika','AGD/RTV') AS kategoria_zmieniona, -- zamiana fragmentu
  TRIM('   tekst z odstƒôpami   ')        AS przyciete              -- przyk≈Çad TRIM na sta≈Çym stringu
FROM products;</code></pre>

    <details>
      <summary class="table-title">Wynik</summary>
      <table class="db-table">
        <thead><tr><th>id</th><th>name</th><th>skrot</th><th>dlugosc</th><th>kategoria_zmieniona</th><th>przyciete</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>Telefon</td><td>Nowy telefon</td><td>16</td><td>AGD/RTV</td><td>tekst z odstƒôpami</td></tr>
          <tr><td>2</td><td>Laptop</td><td>Laptop 15" </td><td>19</td><td>AGD/RTV</td><td>tekst z odstƒôpami</td></tr>
          <tr><td>3</td><td>Czajnik</td><td>Czajnik stalo</td><td>18</td><td>Dom</td><td>tekst z odstƒôpami</td></tr>
        </tbody>
      </table>
      <p class="mini">D≈Çugo≈õci zale≈ºƒÖ od faktycznych tekst√≥w; tu warto≈õci sƒÖ poglƒÖdowe.</p>
    </details>

    <!-- =================== KONWERSJE TYP√ìW =================== -->
    <h2>Konwersje typ√≥w (CAST/CONVERT)</h2>
    <p>
      Czasem musisz ‚Äûprzelaƒá‚Äù dane do innego naczynia (typu). <code>CAST(expr AS type)</code> to standard SQL.
      W MySQL istnieje te≈º <code>CONVERT(expr, type)</code>. W Postgresie do formatowania u≈ºyjesz <code>TO_CHAR</code>, a do parsowania dat ‚Äì <code>TO_DATE</code>.
    </p>

    <h3>CAST/CONVERT ‚Äî przyk≈Çady</h3>
    <pre><code class="language-sql">-- üîÅ R√≥≈ºne konwersje
-- 1) liczba ‚Üí tekst (np. dla ≈ÇƒÖczenia z innymi stringami)
SELECT
  id,
  name,
  CAST(price AS CHAR)          AS cena_jako_tekst   -- MySQL: CHAR; Postgres: ::text / CAST(price AS text)
FROM products;

-- 2) tekst ‚Üí liczba o zadanej precyzji (MySQL)
SELECT
  id,
  CONVERT(amount_text, DECIMAL(10,2)) AS kwota_dec  -- '1234.5' ‚Üí 1234.50
FROM sales;

-- 3) tekst ‚Üí data oraz timestamp ‚Üí sformatowany tekst (PostgreSQL)
SELECT
  TO_DATE('2025-04-21','YYYY-MM-DD')                            AS data_z_tekstu,
  TO_CHAR(TIMESTAMP '2025-04-21 16:45','YYYY-MM-DD HH24:MI')    AS data_formatowana;</code></pre>

    <details open>
      <summary class="table-title">Wynik (poglƒÖdowy)</summary>
      <table class="db-table">
        <thead><tr><th>Przyk≈Çad</th><th>Wynik</th></tr></thead>
        <tbody>
          <tr><td>CAST(1200.00 AS CHAR)</td><td>"1200"</td></tr>
          <tr><td>CONVERT('1234.5', DECIMAL(10,2))</td><td>1234.50</td></tr>
          <tr><td>TO_DATE('2025-04-21','YYYY-MM-DD')</td><td>2025-04-21</td></tr>
          <tr><td>TO_CHAR('2025-04-21 16:45','YYYY-MM-DD HH24:MI')</td><td>2025-04-21 16:45</td></tr>
        </tbody>
      </table>
      <p class="mini">Dobierz typ docelowy do kontekstu (np. <code>DECIMAL(10,2)</code> dla kwot).</p>
    </details>

    <h3>Formatowanie dat ‚Äî MySQL vs PostgreSQL</h3>
    <pre><code class="language-sql">-- MySQL: DATE_FORMAT
SELECT DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') AS ts_fmt;

-- PostgreSQL: TO_CHAR
SELECT TO_CHAR(NOW(), 'YYYY-MM-DD HH24:MI')  AS ts_fmt;</code></pre>

    <details>
      <summary class="table-title">Wynik (poglƒÖdowy)</summary>
      <table class="db-table">
        <thead><tr><th>Silnik</th><th>Wynik</th></tr></thead>
        <tbody>
          <tr><td>MySQL</td><td>2025-09-12 11:00</td></tr>
          <tr><td>PostgreSQL</td><td>2025-09-12 11:00</td></tr>
        </tbody>
      </table>
    </details>

    <h2>Wskaz√≥wki</h2>
    <ul>
      <li>Sprawdzaj dokumentacjƒô swojego silnika ‚Äì nazwy/formaty potrafiƒÖ siƒô r√≥≈ºniƒá.</li>
      <li>Konwersje mogƒÖ wy≈ÇƒÖczyƒá u≈ºycie indeksu (np. <code>WHERE CAST(col AS ...)=...</code>) ‚Äì lepiej przechowywaƒá ju≈º w dobrym typie.</li>
      <li>Przy du≈ºych tekstach u≈ºywaj typ√≥w odpowiedniej wielko≈õci (np. <code>TEXT</code>), aby uniknƒÖƒá obciƒôƒá.</li>
      <li>Filtrowanie po dacie bywa kosztowne ‚Äì indeksuj kolumny datowe i por√≥wnuj do warto≈õci tego samego typu (bez funkcji po lewej stronie).</li>
    </ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-sql.min.js"></script>

  <!-- Styl TYLKO do wizualizacji; nie rusza Twojego styles.css -->
  <style>
    .db-table{width:100%;border-collapse:collapse;margin:.5rem 0}
    .db-table th,.db-table td{border:1px solid #1f2937;padding:.5rem .65rem;text-align:left;vertical-align:top}
    .db-table th{background:#0e1729;color:#dbe2ea}
    .null{color:#9ca3af;font-style:italic}
    details{margin:.75rem 0;border:1px solid #1f2937;border-radius:.5rem;padding:.25rem .5rem;background:#0e1729}
    details[open]{background:#111827}
    summary{cursor:pointer;list-style:none}
    summary::-webkit-details-marker{display:none}
    .table-title{font-weight:600;margin:.25rem 0}
    .mini{color:#a7b0be;font-size:.95rem;margin:.25rem 0 .5rem}
    .note{border-left:4px solid #10b981;padding:.75rem 1rem;background:#0e1729;border-radius:.5rem;margin:1rem 0;color:#cfe3d8}
  </style>
</body>
</html>
