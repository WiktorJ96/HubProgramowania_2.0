<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaawansowane Typy Danych</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <h1>Zaawansowane Typy Danych</h1>

    <p>
      Nowoczesne silniki SQL oferujƒÖ specjalne typy, kt√≥re pozwalajƒÖ przechowywaƒá z≈Ço≈ºone struktury i szybciej je przeszukiwaƒá.
    </p>

    <div class="note">
      <strong>Analogie:</strong> JSON to jak ‚Äûpude≈Çko‚Äù z opisem produktu; ARRAY to ‚Äûlista w jednym polu‚Äù;
      ENUM to ‚Äûzamkniƒôte pude≈Çko z kilkoma dozwolonymi etykietami‚Äù; typy GIS to ‚Äûwsp√≥≈Çrzƒôdne na mapie‚Äù.
    </div>

    <!-- ======================== JSON ======================== -->
    <h2>JSON</h2>
    <p>
      Typ <code>JSON</code> przechowuje dokumenty klucz-warto≈õƒá. W PostgreSQL warto u≈ºywaƒá <code>JSONB</code> (binarna forma) dla indeks√≥w i wydajno≈õci.
    </p>

    <pre><code class="language-sql">-- üß± Tworzenie tabeli z kolumnƒÖ JSON
CREATE TABLE products (
  id   SERIAL PRIMARY KEY,  -- unikalny identyfikator
  info JSON                 -- dokument z danymi produktu
);

-- ‚ûï Wstawienie dokumentu JSON
INSERT INTO products(info)
VALUES (
  '{"name":"Laptop","specs":{"ram":16,"ssd":512}}'
);

-- üîé Zapytanie po kluczach wewnƒôtrznych (PostgreSQL)
SELECT
  info-&gt;&gt;'name'                 AS nazwa,     -- operator -&gt;&gt;: wyciƒÖga tekst
  (info-&gt;'specs')-&gt;&gt;'ram'       AS ram        -- operator -&gt;: zwraca pod-JSON
FROM products
WHERE (info-&gt;'specs')-&gt;&gt;'ssd' = '512';        -- filtr po warto≈õci w dokumencie</code></pre>

    <details open>
      <summary class="table-title">Dane wej≈õciowe / wynik (poglƒÖdowe)</summary>
      <div class="grid-two">
        <table class="db-table">
          <caption class="mini">products (fragment)</caption>
          <thead><tr><th>id</th><th>info</th></tr></thead>
          <tbody>
            <tr><td>1</td><td>{"name":"Laptop","specs":{"ram":16,"ssd":512}}</td></tr>
            <tr><td>2</td><td>{"name":"Telefon","specs":{"ram":8,"ssd":128}}</td></tr>
          </tbody>
        </table>

        <table class="db-table">
          <caption class="mini">Wynik SELECT</caption>
          <thead><tr><th>nazwa</th><th>ram</th></tr></thead>
          <tbody>
            <tr><td>Laptop</td><td>16</td></tr>
          </tbody>
        </table>
      </div>
      <p class="mini">Operator <code>-&gt;</code> daje JSON, <code>-&gt;&gt;</code> daje tekst (konwersja).</p>
    </details>

    <p>Indeksowanie: za≈Ç√≥≈º <code>GIN</code> na <code>JSONB</code> (szybkie szukanie po kluczach/≈õcie≈ºkach).</p>

    <pre><code class="language-sql">-- üîÅ Konwersja na JSONB i indeks GIN (PostgreSQL)
ALTER TABLE products
  ALTER COLUMN info TYPE JSONB USING info::JSONB;

CREATE INDEX idx_products_info
  ON products USING GIN (info);</code></pre>

    <details>
      <summary class="table-title">Co daje indeks GIN na JSONB?</summary>
      <table class="db-table">
        <thead><tr><th>cecha</th><th>efekt</th></tr></thead>
        <tbody>
          <tr><td>przeszukiwanie po kluczach</td><td>szybsze filtry po ≈õcie≈ºkach (np. specs‚Üíssd)</td></tr>
          <tr><td>dopasowanie fragment√≥w</td><td>mo≈ºliwe zapytania typu <code>info @&gt; '{...}'</code></td></tr>
        </tbody>
      </table>
    </details>

    <!-- ======================== ARRAY ======================== -->
    <h2>ARRAY (tablice)</h2>
    <p>PrzechowujƒÖ listy warto≈õci w jednej kolumnie. Wygodne, gdy ‚Äûkilka odpowiedzi‚Äù nale≈ºy do jednego rekordu.</p>

    <pre><code class="language-sql">-- üß± Tabela z polem tablicowym (PostgreSQL)
CREATE TABLE surveys (
  id      SERIAL PRIMARY KEY,
  answers TEXT[]               -- tablica tekst√≥w
);

-- ‚ûï Wstawienie kilku odpowiedzi
INSERT INTO surveys(answers)
VALUES (ARRAY['Tak','Nie','Nie wiem']);

-- üîé Zapytanie: czy w tablicy jest 'Tak'?
SELECT *
FROM surveys
WHERE 'Tak' = ANY(answers);     -- ANY: sprawd≈∫ cz≈Çonkostwo w tablicy</code></pre>

    <details open>
      <summary class="table-title">Dane wej≈õciowe / wynik (poglƒÖdowe)</summary>
      <div class="grid-two">
        <table class="db-table">
          <caption class="mini">surveys</caption>
          <thead><tr><th>id</th><th>answers</th></tr></thead>
          <tbody>
            <tr><td>1</td><td>{"Tak","Nie","Nie wiem"}</td></tr>
            <tr><td>2</td><td>{"Nie"}</td></tr>
          </tbody>
        </table>

        <table class="db-table">
          <caption class="mini">Wynik SELECT (WHERE 'Tak' = ANY)</caption>
          <thead><tr><th>id</th><th>answers</th></tr></thead>
          <tbody>
            <tr><td>1</td><td>{"Tak","Nie","Nie wiem"}</td></tr>
          </tbody>
        </table>
      </div>
      <p class="mini"><code>ANY</code> dzia≈Ça jak ‚Äûczy element jest w tej tablicy?‚Äù.</p>
    </details>

    <p>Indeksowanie tablic: <code>GIN</code> lub <code>GiST</code> przyspiesza wyszukiwanie element√≥w.</p>

    <pre><code class="language-sql">-- ‚ö° Indeks GIN (PostgreSQL)
CREATE INDEX idx_surveys_answers
  ON surveys USING GIN (answers);</code></pre>

    <details>
      <summary class="table-title">Efekt indeksu na ARRAY</summary>
      <table class="db-table">
        <thead><tr><th>zapytanie</th><th>z indeksami</th><th>bez indeks√≥w</th></tr></thead>
        <tbody>
          <tr><td><code>WHERE 'Tak' = ANY(answers)</code></td><td>szybko</td><td>wolniej (skan)</td></tr>
        </tbody>
      </table>
    </details>

    <!-- ======================== ENUM ======================== -->
    <h2>ENUM (wyliczeniowy)</h2>
    <p><code>ENUM</code> ogranicza kolumnƒô do z g√≥ry ustalonych warto≈õci (np. statusy).</p>

    <pre><code class="language-sql">-- üß± Definicja typu ENUM (PostgreSQL)
CREATE TYPE order_status AS ENUM ('pending','shipped','delivered','canceled');

-- ‚ûï U≈ºycie w tabeli
CREATE TABLE orders (
  id     SERIAL PRIMARY KEY,
  status order_status
);

-- ‚ûï Wstaw poprawnƒÖ warto≈õƒá
INSERT INTO orders(status) VALUES ('shipped');  -- OK

-- ‚úñ Pr√≥ba wstawienia warto≈õci spoza listy
-- INSERT INTO orders(status) VALUES ('unknown'); -- b≈ÇƒÖd</code></pre>

    <details open>
      <summary class="table-title">Wynik (poglƒÖdowy)</summary>
      <table class="db-table">
        <thead><tr><th>id</th><th>status</th></tr></thead>
        <tbody>
          <tr><td>1</td><td>shipped</td></tr>
        </tbody>
      </table>
      <p class="mini"><strong>Zaleta:</strong> gwarancja poprawnych warto≈õci. <strong>Uwaga:</strong> zmiana listy wymaga <code>ALTER TYPE ... ADD VALUE</code>.</p>
    </details>

    <!-- ======================== GIS ======================== -->
    <h2>Typy przestrzenne (GIS ‚Äì Geospatial)</h2>
    <p>PrzechowujƒÖ geometriƒô: punkty, linie, wielokƒÖty. WymagajƒÖ rozszerze≈Ñ (np. PostGIS w PostgreSQL).</p>

    <pre><code class="language-sql">-- üß± Punkt na mapie (PostgreSQL + PostGIS)
CREATE TABLE places (
  id   SERIAL PRIMARY KEY,
  name TEXT,
  location GEOMETRY(Point, 4326)     -- SRID 4326 = WGS84 (lat/lon)
);

-- ‚ûï Wstaw punkt
INSERT INTO places(name, location)
VALUES ('Rynek', ST_GeomFromText('POINT(21.012229 52.229676)', 4326));

-- üîé Znajd≈∫ miejsca w promieniu 1 km od punktu odniesienia
SELECT name
FROM places
WHERE ST_DWithin(
  location::geography,                      -- rzutuj na geographiƒô (metry)
  ST_MakePoint(21.012229, 52.229676)::geography,
  1000                                      -- promie≈Ñ 1000 m
);</code></pre>

    <details open>
      <summary class="table-title">Dane wej≈õciowe / wynik (poglƒÖdowe)</summary>
      <div class="grid-two">
        <table class="db-table">
          <caption class="mini">places</caption>
          <thead><tr><th>id</th><th>name</th><th>location (WKT)</th></tr></thead>
          <tbody>
            <tr><td>1</td><td>Rynek</td><td>POINT(21.012229 52.229676)</td></tr>
            <tr><td>2</td><td>Muzeum</td><td>POINT(21.000000 52.230000)</td></tr>
          </tbody>
        </table>

        <table class="db-table">
          <caption class="mini">Wynik ST_DWithin (1 km)</caption>
          <thead><tr><th>name</th></tr></thead>
          <tbody>
            <tr><td>Rynek</td></tr>
            <tr><td>Muzeum</td></tr>
          </tbody>
        </table>
      </div>
      <p class="mini"><code>ST_DWithin</code> na <em>geography</em> liczy odleg≈Ço≈õci w metrach. Na <em>geometry</em> ‚Äî w jednostkach uk≈Çadu wsp√≥≈Çrzƒôdnych.</p>
    </details>

    <p>Indeksowanie przestrzenne przyspiesza zapytania z warunkami ‚Äûw pobli≈ºu / w poligonie‚Äù.</p>

    <pre><code class="language-sql">-- ‚ö° Indeks przestrzenny (PostgreSQL + PostGIS)
CREATE INDEX idx_places_location
  ON places USING GIST (location);</code></pre>

    <details>
      <summary class="table-title">Efekt indeksu przestrzennego</summary>
      <table class="db-table">
        <thead><tr><th>zapytanie</th><th>z indeksem</th><th>bez indeksu</th></tr></thead>
        <tbody>
          <tr><td><code>ST_DWithin(location,...)</code></td><td>szybko</td><td>wolno (skan)</td></tr>
          <tr><td><code>ST_Within(location, polygon)</code></td><td>szybko</td><td>wolno</td></tr>
        </tbody>
      </table>
    </details>

    <!-- ======================== WSKAZ√ìWKI ======================== -->
    <h2>Wskaz√≥wki</h2>
    <ul>
      <li><strong>JSONB &gt; JSON</strong> (PostgreSQL) ‚Äî lepsza wydajno≈õƒá i indeksy.</li>
      <li><strong>GIN</strong> do przeszukiwania element√≥w w JSON/ARRAY; <strong>GiST/SP-GiST</strong> dla geometrii.</li>
      <li><strong>ENUM</strong> gwarantuje poprawno≈õƒá warto≈õci; zmiany listy przez <code>ALTER TYPE</code>.</li>
      <li>W GIS pilnuj w≈Ça≈õciwego <strong>SRID</strong> i konwersji <em>geometry</em> ‚Üî <em>geography</em>.</li>
      <li>Monitoruj rozmiary dokument√≥w JSON/ARRAY ‚Äî bardzo du≈ºe rekordy utrudniƒÖ backupy i I/O.</li>
    </ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-sql.min.js"></script>

  <!-- Styl TYLKO do wizualizacji; nie rusza Twojego styles.css -->
  <style>
    .db-table{width:100%;border-collapse:collapse;margin:.5rem 0}
    .db-table th,.db-table td{border:1px solid #1f2937;padding:.5rem .65rem;text-align:left;vertical-align:top}
    .db-table th{background:#0e1729;color:#dbe2ea}
    .null{color:#9ca3af;font-style:italic}
    details{margin:.75rem 0;border:1px solid #1f2937;border-radius:.5rem;padding:.25rem .5rem;background:#0e1729}
    details[open]{background:#111827}
    summary{cursor:pointer;list-style:none}
    summary::-webkit-details-marker{display:none}
    .table-title{font-weight:600;margin:.25rem 0}
    .mini{color:#a7b0be;font-size:.95rem;margin:.25rem 0 .5rem}
    .note{border-left:4px solid #10b981;padding:.75rem 1rem;background:#0e1729;border-radius:.5rem;margin:1rem 0;color:#cfe3d8}
    .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
    @media (max-width: 900px){.grid-two{grid-template-columns:1fr}}
  </style>
</body>
</html>
