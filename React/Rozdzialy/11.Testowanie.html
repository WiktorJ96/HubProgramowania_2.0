<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React - Testowanie z Jest i React Testing Library</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <h1>React - Testowanie z Jest i React Testing Library</h1>
        
        <p>Testowanie jednostkowe to technika, kt√≥ra pozwala na sprawdzanie poprawno≈õci poszczeg√≥lnych funkcji i komponent√≥w w izolacji. W React najczƒô≈õciej u≈ºywa siƒô do tego narzƒôdzi takich jak <code>Jest</code> (biblioteka testowa) i <code>React Testing Library</code> (do testowania komponent√≥w React).</p>

        <h2>Instalacja Jest i React Testing Library</h2>
        <p>Aby rozpoczƒÖƒá testowanie, nale≈ºy zainstalowaƒá <code>jest</code> oraz <code>@testing-library/react</code>:</p>

        <pre><code class="language-bash">
npm install --save-dev jest @testing-library/react @testing-library/jest-dom
        </code></pre>

        <h2>Pisanie Prostych Test√≥w za pomocƒÖ Jest</h2>
        <p>Jest jest bibliotekƒÖ do testowania, kt√≥ra pozwala na definiowanie test√≥w przy u≈ºyciu funkcji takich jak <code>test</code>, <code>expect</code>, <code>describe</code>, itp. Poni≈ºszy przyk≈Çad pokazuje test funkcji sumujƒÖcej liczby.</p>

        <pre><code class="language-javascript">
// sum.js
export function sum(a, b) {
    return a + b;
}

// sum.test.js
import { sum } from './sum';

test('Dodaje 1 + 2, aby uzyskaƒá 3', () => {
    expect(sum(1, 2)).toBe(3);
});
        </code></pre>

        <!-- WIZ: JEST -->
        <details open>
          <summary class="viz-title">üß™ Wizualizacja przep≈Çywu: <strong>Jest</strong> (Arrange ‚Üí Act ‚Üí Assert)</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 360" class="viz-svg" aria-label="Jest AAA">
              <defs>
                <marker id="arr-jest" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>
              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="340" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Arrange ‚Üí Act ‚Üí Assert ‚Üí Wynik testu</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="260" height="70" rx="10"></rect>
                  <text x="12" y="28">Arrange (przygotowanie)</text>
                  <text x="12" y="48" class="muted">import { sum } / dane wej≈õciowe</text>
                </g>
                <path class="arrow" d="M280,95 L460,95" marker-end="url(#arr-jest)"/>

                <g class="pill" transform="translate(460,60)">
                  <rect width="220" height="70" rx="10"></rect>
                  <text x="12" y="28">Act (wykonanie)</text>
                  <text x="12" y="48" class="muted">sum(1,2)</text>
                </g>
                <path class="arrow" d="M680,95 L920,95" marker-end="url(#arr-jest)"/>

                <g class="ok" transform="translate(700,60)">
                  <rect width="260" height="70" rx="10"></rect>
                  <text x="12" y="28">Assert (sprawdzenie)</text>
                  <text x="12" y="48" class="muted">expect(wynik).toBe(3)</text>
                </g>

                <g transform="translate(20,160)">
                  <foreignObject width="940" height="170">
                    <div xmlns="http://www.w3.org/1999/xhtml">
                      <div class="grid-two">
                        <table class="db-table">
                          <caption class="mini">Przyk≈Çady matcher√≥w</caption>
                          <thead><tr><th>Matcher</th><th>Opis</th></tr></thead>
                          <tbody>
                            <tr><td><code>toBe</code></td><td>Por√≥wnanie ≈õcis≈Çe (===) liczby/napisy/boolean</td></tr>
                            <tr><td><code>toEqual</code></td><td>G≈Çƒôbokie por√≥wnanie obiekt√≥w/tablic</td></tr>
                            <tr><td><code>toBeTruthy/Falsy</code></td><td>Prawdziwo≈õƒá/fa≈Çszywo≈õƒá</td></tr>
                          </tbody>
                        </table>
                        <table class="db-table">
                          <caption class="mini">Skr√≥cony raport</caption>
                          <thead><tr><th>Wej≈õcie</th><th>Oczekiwane</th><th>Wynik</th></tr></thead>
                          <tbody>
                            <tr><td>1 + 2</td><td>3</td><td>‚úÖ PASS</td></tr>
                            <tr><td>0 + 0</td><td>0</td><td>‚úÖ PASS</td></tr>
                            <tr><td>2 + 2</td><td>5</td><td>‚ùå FAIL (4 ‚â† 5)</td></tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </foreignObject>
                </g>
              </g>
            </svg>
          </div>
        </details>

        <p>W powy≈ºszym przyk≈Çadzie <code>test</code> sprawdza, czy funkcja <code>sum</code> zwraca poprawny wynik dla podanych warto≈õci.</p>

        <h2>Testowanie Komponent√≥w za pomocƒÖ React Testing Library</h2>
        <p>React Testing Library pozwala na renderowanie komponent√≥w w wirtualnym ≈õrodowisku do test√≥w. Pozwala na interakcjƒô z elementami tak, jakby by≈Çy renderowane w przeglƒÖdarce.</p>

        <pre><code class="language-javascript">
// Greeting.js
import React from 'react';

function Greeting({ name }) {
    return &lt;h1&gt;Hello, {name}!&lt;/h1&gt;;
}

export default Greeting;

// Greeting.test.js
import React from 'react';
import { render, screen } from '@testing-library/react';
import '@testing-library/jest-dom';
import Greeting from './Greeting';

test('Wy≈õwietla powitanie z imieniem', () => {
    render(&lt;Greeting name="Jan" /&gt;);
    const greetingElement = screen.getByText(/Hello, Jan!/i);
    expect(greetingElement).toBeInTheDocument();
});
        </code></pre>

        <!-- WIZ: RTL render/getByText -->
        <details>
          <summary class="viz-title">üß© Wizualizacja: <strong>render ‚Üí query ‚Üí asercja</strong> (RTL)</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 360" class="viz-svg" aria-label="RTL render query">
              <defs>
                <marker id="arr-rtl" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>
              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="340" rx="12"></rect>
                <text x="16" y="28" class="lane-title">render() ‚áí screen.getByText() ‚áí expect(...)</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="300" height="70" rx="10"></rect>
                  <text x="12" y="28">render(&lt;Greeting name="Jan"/&gt;)</text>
                  <text x="12" y="48" class="muted">wirtualny DOM testowy</text>
                </g>
                <path class="arrow" d="M320,95 L520,95" marker-end="url(#arr-rtl)"/>

                <g class="pill" transform="translate(520,60)">
                  <rect width="220" height="70" rx="10"></rect>
                  <text x="12" y="28">screen.getByText(/Hello, Jan!/i)</text>
                  <text x="12" y="48" class="muted">wyszukiwanie elementu</text>
                </g>
                <path class="arrow" d="M740,95 L940,95" marker-end="url(#arr-rtl)"/>

                <g class="ok" transform="translate(760,60)">
                  <rect width="210" height="70" rx="10"></rect>
                  <text x="12" y="28">expect(...).toBeInTheDocument()</text>
                </g>

                <g transform="translate(20,160)">
                  <foreignObject width="940" height="160">
                    <div xmlns="http://www.w3.org/1999/xhtml">
                      <div class="grid-two">
                        <table class="db-table">
                          <caption class="mini">Rodziny zapyta≈Ñ (skr√≥t)</caption>
                          <thead><tr><th>Metoda</th><th>Kiedy</th></tr></thead>
                          <tbody>
                            <tr><td><code>getBy*</code></td><td>Element MUSI istnieƒá (rzuca, gdy brak)</td></tr>
                            <tr><td><code>queryBy*</code></td><td>Element MO≈ªE nie istnieƒá (zwraca null)</td></tr>
                            <tr><td><code>findBy*</code></td><td>Asynchroniczne czekanie na element</td></tr>
                          </tbody>
                        </table>
                        <table class="db-table">
                          <caption class="mini">Dobre praktyki</caption>
                          <thead><tr><th>Punkt</th><th>Dlaczego</th></tr></thead>
                          <tbody>
                            <tr><td>Preferuj role/label</td><td>Bli≈ºej realnego UX: <code>getByRole('heading',{name:/hello/i})</code></td></tr>
                            <tr><td>Unikaj test√≥w implementacji</td><td>Testuj zachowanie, nie szczeg√≥≈Çy DOM</td></tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </foreignObject>
                </g>
              </g>
            </svg>
          </div>
        </details>

        <p>Test <code>Greeting</code> sprawdza, czy komponent renderuje siƒô poprawnie z przekazanym <code>name</code>. Funkcja <code>getByText</code> szuka tekstu "Hello, Jan!" w komponencie.</p>

        <h2>Symulowanie Zdarze≈Ñ</h2>
        <p>React Testing Library umo≈ºliwia symulowanie zdarze≈Ñ, takich jak klikniƒôcia, dziƒôki funkcji <code>fireEvent</code>. Jest to przydatne do testowania interakcji u≈ºytkownika.</p>

        <pre><code class="language-javascript">
// Button.js
import React, { useState } from 'react';

function Button() {
    const [count, setCount] = useState(0);
    return (
        &lt;div&gt;
            &lt;p&gt;Klikniƒôcia: {count}&lt;/p&gt;
            &lt;button onClick={() =&gt; setCount(count + 1)}&gt;Kliknij mnie&lt;/button&gt;
        &lt;/div&gt;
    );
}

export default Button;

// Button.test.js
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import '@testing-library/jest-dom';
import Button from './Button';

test('Zwiƒôksza licznik po klikniƒôciu', () => {
    render(&lt;Button /&gt;);
    const buttonElement = screen.getByText(/Kliknij mnie/i);
    fireEvent.click(buttonElement);
    const countElement = screen.getByText(/Klikniƒôcia: 1/i);
    expect(countElement).toBeInTheDocument();
});
        </code></pre>

        <!-- WIZ: fireEvent -->
        <details>
          <summary class="viz-title">üñ±Ô∏è Wizualizacja: klik ‚Üí setState ‚Üí re-render ‚Üí asercja</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 380" class="viz-svg" aria-label="fireEvent flow">
              <defs>
                <marker id="arr-fire" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>
              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="360" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Interakcja u≈ºytkownika i aktualizacja stanu</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="260" height="70" rx="10"></rect>
                  <text x="12" y="28">render(&lt;Button/&gt;)</text>
                  <text x="12" y="48" class="muted">DOM: ‚ÄûKlikniƒôcia: 0‚Äù</text>
                </g>
                <path class="arrow" d="M280,95 L460,95" marker-end="url(#arr-fire)"/>

                <g class="pill" transform="translate(460,60)">
                  <rect width="240" height="70" rx="10"></rect>
                  <text x="12" y="28">fireEvent.click(button)</text>
                  <text x="12" y="48" class="muted">onClick ‚Üí setCount(1)</text>
                </g>
                <path class="arrow" d="M700,95 L920,95" marker-end="url(#arr-fire)"/>

                <g class="ok" transform="translate(720,60)">
                  <rect width="240" height="70" rx="10"></rect>
                  <text x="12" y="28">ponowny render</text>
                  <text x="12" y="48" class="muted">DOM: ‚ÄûKlikniƒôcia: 1‚Äù</text>
                </g>

                <g transform="translate(20,160)">
                  <foreignObject width="940" height="170">
                    <div xmlns="http://www.w3.org/1999/xhtml">
                      <div class="grid-two">
                        <table class="db-table">
                          <caption class="mini">Zdarzenia (skr√≥t)</caption>
                          <thead><tr><th>Metoda</th><th>Przyk≈Çad</th></tr></thead>
                          <tbody>
                            <tr><td><code>fireEvent.click</code></td><td>klik, <code>fireEvent.change</code>, <code>fireEvent.keyDown</code>‚Ä¶</td></tr>
                            <tr><td><code>userEvent</code></td><td>Bardziej realistyczne (op√≥≈∫nienia, selekcja, wpisywanie)</td></tr>
                          </tbody>
                        </table>
                        <table class="db-table">
                          <caption class="mini">Asercja</caption>
                          <thead><tr><th>Krok</th><th>Spodziewany wynik</th></tr></thead>
                          <tbody>
                            <tr><td>Po klikniƒôciu</td><td><code>screen.getByText(/Klikniƒôcia: 1/)</code> ‚Üí ‚úÖ</td></tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </foreignObject>
                </g>
              </g>
            </svg>
          </div>
        </details>

        <p>W powy≈ºszym przyk≈Çadzie test sprawdza, czy klikniƒôcie przycisku powoduje zwiƒôkszenie licznika. <code>fireEvent.click</code> symuluje klikniƒôcie na przycisk.</p>

        <h2>Testowanie Asynchroniczne</h2>
        <p>React Testing Library umo≈ºliwia r√≥wnie≈º testowanie kodu asynchronicznego przy u≈ºyciu funkcji <code>findBy</code> lub <code>waitFor</code> do czekania na rezultaty asynchroniczne.</p>

        <pre><code class="language-javascript">
// AsyncComponent.js
import React, { useState, useEffect } from 'react';

function AsyncComponent() {
    const [data, setData] = useState(null);

    useEffect(() => {
        setTimeout(() => {
            setData("Za≈Çadowano dane!");
        }, 1000);
    }, []);

    return &lt;p&gt;{data ? data : "≈Åadowanie..." }&lt;/p&gt;;
}

export default AsyncComponent;

// AsyncComponent.test.js
import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import AsyncComponent from './AsyncComponent';

test('Za≈Çadowano dane po up≈Çywie czasu', async () => {
    render(&lt;AsyncComponent /&gt;);
    const dataElement = await waitFor(() => screen.getByText(/Za≈Çadowano dane!/i));
    expect(dataElement).toBeInTheDocument();
});
        </code></pre>

        <!-- WIZ: async waitFor/findBy -->
        <details>
          <summary class="viz-title">‚è≥ Wizualizacja: stan ‚Äû≈Åadowanie‚Ä¶‚Äù ‚Üí dane (asynchronicznie)</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 380" class="viz-svg" aria-label="Async flow">
              <defs>
                <marker id="arr-async" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>
              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="360" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Efekt ‚Üí op√≥≈∫nienie ‚Üí aktualizacja ‚Üí asercja</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="300" height="70" rx="10"></rect>
                  <text x="12" y="28">render(&lt;AsyncComponent/&gt;)</text>
                  <text x="12" y="48" class="muted">‚Äû≈Åadowanie‚Ä¶‚Äù</text>
                </g>
                <path class="arrow" d="M320,95 L520,95" marker-end="url(#arr-async)"/>

                <g class="pill" transform="translate(520,60)">
                  <rect width="200" height="70" rx="10"></rect>
                  <text x="12" y="28">useEffect ‚Üí setTimeout</text>
                  <text x="12" y="48" class="muted">1000 ms</text>
                </g>
                <path class="arrow" d="M720,95 L920,95" marker-end="url(#arr-async)"/>

                <g class="ok" transform="translate(740,60)">
                  <rect width="230" height="70" rx="10"></rect>
                  <text x="12" y="28">setData("Za≈Çadowano dane!")</text>
                  <text x="12" y="48" class="muted">ponowny render</text>
                </g>

                <g transform="translate(20,160)">
                  <foreignObject width="940" height="170">
                    <div xmlns="http://www.w3.org/1999/xhtml">
                      <div class="grid-two">
                        <table class="db-table">
                          <caption class="mini">findBy vs waitFor</caption>
                          <thead><tr><th>Metoda</th><th>U≈ºycie</th></tr></thead>
                          <tbody>
                            <tr><td><code>findBy*</code></td><td>Bezpo≈õrednio czeka na element (np. <code>await screen.findByText(...)</code>)</td></tr>
                            <tr><td><code>waitFor</code></td><td>Czeka na spe≈Çnienie dowolnego warunku w callbacku</td></tr>
                          </tbody>
                        </table>
                        <table class="db-table">
                          <caption class="mini">Asercja ko≈Ñcowa</caption>
                          <thead><tr><th>Po 1s</th><th>Spodziewany DOM</th></tr></thead>
                          <tbody>
                            <tr><td>render po setState</td><td>‚ÄûZa≈Çadowano dane!‚Äù w dokumencie ‚Üí ‚úÖ</td></tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </foreignObject>
                </g>
              </g>
            </svg>
          </div>
        </details>

        <p>W tym przyk≈Çadzie <code>waitFor</code> czeka, a≈º komponent <code>AsyncComponent</code> za≈Çaduje dane, a nastƒôpnie sprawdza, czy tekst "Za≈Çadowano dane!" jest wy≈õwietlony.</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-javascript.min.js"></script>

    <!-- CSS: wizualizacje responsywne i pe≈Çna szeroko≈õƒá -->
    <style>
      /* Blok wizualizacji */
      details, .viz-wrap { width:100%; max-width:none !important; }
      .viz-title{cursor:pointer;font-weight:600}
      .viz-wrap{padding:.5rem .25rem}

      /* SVG: pe≈Çna szeroko≈õƒá, responsywne */
      .viz-svg{display:block;width:100% !important;max-width:100% !important;height:auto !important;background:#0e1729;border-radius:12px}

      /* Schemat kolor√≥w blok√≥w */
      .lane rect{fill:#0f172a;stroke:#1f2937}
      .lane-title{fill:#cbd5e1;font-weight:600}
      .node rect{fill:#111827;stroke:#334155}
      .pill rect{fill:#0b3b2e;stroke:#14532d}
      .ok rect{fill:#0b2a3b;stroke:#0e7490}
      .warn rect{fill:#3b0b0b;stroke:#7f1d1d}
      .node text,.pill text,.ok text,.warn text{fill:#e2e8f0;font-size:14px}
      .muted{fill:#94a3b8;font-size:12px}
      .arrow{stroke:#94a3b8;stroke-width:2;fill:none}

      /* Layout / tabele */
      .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
      @media (max-width: 900px){.grid-two{grid-template-columns:1fr}}
      .db-table{width:100% !important;max-width:100% !important;border-collapse:collapse;margin:.5rem 0;table-layout:fixed}
      .db-table th,.db-table td{border:1px solid #aeaeae;padding:.5rem .65rem;text-align:left;vertical-align:top;word-break:break-word}
      .db-table th{background:#0e1729;color:#dbe2ea}
      .mini{color:#a7b0be;font-size:.95rem}

      /* Kod ‚Äì pe≈Çna szeroko≈õƒá + poziomy scroll, gdy trzeba */
      pre[class*="language-"]{width:100% !important;max-width:none !important;box-sizing:border-box;overflow-x:auto;white-space:pre}
      code[class*="language-"]{white-space:pre}
    </style>
</body>
</html>
