<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React - Error Boundaries</title>
    <link rel="stylesheet" href="../styles.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <h1>React - Error Boundaries</h1>

    <p>Error Boundaries to mechanizm wprowadzony w React 16, ktÃ³ry pozwala przechwytywaÄ‡ bÅ‚Ä™dy w komponentach podrzÄ™dnych. DziÄ™ki nim moÅ¼emy zapobiec awarii caÅ‚ej aplikacji, wyÅ›wietlajÄ…c zamiast tego komunikat o bÅ‚Ä™dzie lub zastÄ™pczy interfejs.</p>

    <h2>Tworzenie Error Boundary</h2>
    <p>Error Boundary to komponent klasowy, ktÃ³ry implementuje dwie specjalne metody: <code>componentDidCatch</code> do przechwytywania bÅ‚Ä™dÃ³w i <code>getDerivedStateFromError</code> do aktualizacji stanu w przypadku bÅ‚Ä™du.</p>

<pre><code class="language-javascript">
import React, { Component } from 'react';

class ErrorBoundary extends Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    // Ustawia stan na true w przypadku bÅ‚Ä™du
    return { hasError: true };
  }

  componentDidCatch(error, info) {
    // MoÅ¼emy tu zalogowaÄ‡ bÅ‚Ä…d do systemu monitorowania
    console.error("BÅ‚Ä…d:", error, info);
  }

  render() {
    if (this.state.hasError) {
      return &lt;h2&gt;CoÅ› poszÅ‚o nie tak.&lt;/h2&gt;;
    }
    return this.props.children;
  }
}

export default ErrorBoundary;
</code></pre>

    <!-- WIZ 1: przepÅ‚yw bÅ‚Ä™du -->
    <details open>
      <summary class="viz-title">ğŸ›¡ï¸ Wizualizacja: PrzepÅ‚yw bÅ‚Ä™du â†’ przechwycenie â†’ fallback UI</summary>
      <div class="viz-wrap">
        <svg viewBox="0 0 1100 420" class="viz-svg" aria-label="Error boundary flow">
          <defs>
            <marker id="arr-eb" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
              <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
            </marker>
          </defs>

          <g class="lane" transform="translate(10,10)">
            <rect width="1080" height="400" rx="12"></rect>
            <text x="16" y="28" class="lane-title">Render drzewa â†’ bÅ‚Ä…d w dziecku â†’ boundary reaguje â†’ fallback</text>

            <g class="node" transform="translate(20,60)">
              <rect width="320" height="70" rx="10"></rect>
              <text x="12" y="28">Render &lt;FaultyComponent /&gt;</text>
              <text x="12" y="48" class="muted">throw new Error(...)</text>
            </g>

            <path class="arrow" d="M340,95 L540,95" marker-end="url(#arr-eb)" />

            <g class="warn" transform="translate(540,60)">
              <rect width="280" height="70" rx="10"></rect>
              <text x="12" y="26">BÅÄ„D propaguje w gÃ³rÄ™</text>
              <text x="12" y="46" class="muted">szuka najbliÅ¼szego ErrorBoundary</text>
            </g>

            <path class="arrow" d="M820,95 L1040,95" marker-end="url(#arr-eb)" />

            <g class="pill" transform="translate(20,170)">
              <rect width="500" height="90" rx="10"></rect>
              <text x="12" y="30">static getDerivedStateFromError(error)</text>
              <text x="12" y="52" class="muted">ustawia hasError = true (synchronizuje stan)</text>
            </g>

            <path class="arrow" d="M520,215 L740,215" marker-end="url(#arr-eb)" />

            <g class="ok" transform="translate(740,170)">
              <rect width="330" height="90" rx="10"></rect>
              <text x="12" y="30">componentDidCatch(error, info)</text>
              <text x="12" y="52" class="muted">logowanie/raportowanie bÅ‚Ä™du</text>
            </g>

            <g class="node" transform="translate(20,300)">
              <rect width="1050" height="70" rx="10"></rect>
              <text x="12" y="28">render() â†’ jeÅ›li hasError: pokaÅ¼ fallback (np. â€CoÅ› poszÅ‚o nie tak.â€)</text>
              <text x="12" y="48" class="muted">aplikacja dziaÅ‚a dalej, bÅ‚Ä…d izolowany do poddrzewa</text>
            </g>
          </g>
        </svg>
      </div>
    </details>

    <p>W tym przykÅ‚adzie, jeÅ›li dowolny komponent wewnÄ…trz <code>ErrorBoundary</code> wyrzuci bÅ‚Ä…d, zostanie on przechwycony, a komponent wyÅ›wietli komunikat <code>"CoÅ› poszÅ‚o nie tak."</code> zamiast zawartoÅ›ci.</p>

    <h2>UÅ¼ycie Error Boundary</h2>
    <p>Opakuj komponenty, ktÃ³re mogÄ… potencjalnie wywoÅ‚aÄ‡ bÅ‚Ä…d, moÅ¼liwie nisko w drzewie, aby zminimalizowaÄ‡ wpÅ‚yw bÅ‚Ä™du na resztÄ™ aplikacji.</p>

<pre><code class="language-javascript">
import React from 'react';
import ErrorBoundary from './ErrorBoundary';
import FaultyComponent from './FaultyComponent';

function App() {
  return (
    &lt;div&gt;
      &lt;h1&gt;Aplikacja React z Error Boundary&lt;/h1&gt;
      &lt;ErrorBoundary&gt;
        &lt;FaultyComponent /&gt;
      &lt;/ErrorBoundary&gt;
    &lt;/div&gt;
  );
}

export default App;
</code></pre>

    <!-- WIZ 2: wiele boundary -->
    <details>
      <summary class="viz-title">ğŸ§© Wizualizacja: Wiele Error Boundaries (izolacja poddrzew)</summary>
      <div class="viz-wrap">
        <svg viewBox="0 0 1100 520" class="viz-svg" aria-label="Multiple boundaries tree">
          <defs>
            <marker id="arr-eb2" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
              <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
            </marker>
          </defs>

          <g class="lane" transform="translate(10,10)">
            <rect width="1080" height="500" rx="12"></rect>
            <text x="16" y="28" class="lane-title">Struktura: App â†’ Sekcje A/B z osobnymi boundary</text>

            <!-- Schemat drzewa -->
            <g class="node" transform="translate(40,70)">
              <rect width="220" height="60" rx="10"></rect>
              <text x="12" y="36">App</text>
            </g>

            <path class="arrow" d="M150,130 L150,180" marker-end="url(#arr-eb2)" />
            <g class="pill" transform="translate(40,180)">
              <rect width="220" height="60" rx="10"></rect>
              <text x="12" y="36">Header</text>
            </g>

            <path class="arrow" d="M150,240 L150,300" marker-end="url(#arr-eb2)" />
            <g class="ok" transform="translate(40,300)">
              <rect width="220" height="60" rx="10"></rect>
              <text x="12" y="36">Footer</text>
            </g>

            <!-- Kolumna A -->
            <g class="node" transform="translate(360,70)">
              <rect width="320" height="60" rx="10"></rect>
              <text x="12" y="36">ErrorBoundary (Sekcja A)</text>
            </g>
            <path class="arrow" d="M520,130 L520,180" marker-end="url(#arr-eb2)" />
            <g class="pill" transform="translate(360,180)">
              <rect width="320" height="60" rx="10"></rect>
              <text x="12" y="36">A: &lt;Chart /&gt;</text>
            </g>
            <path class="arrow" d="M520,240 L520,300" marker-end="url(#arr-eb2)" />
            <g class="warn" transform="translate(360,300)">
              <rect width="320" height="60" rx="10"></rect>
              <text x="12" y="30">A: &lt;FaultyWidget /&gt; âŒ</text>
              <text x="12" y="50" class="muted">rzuca bÅ‚Ä…d</text>
            </g>
            <g class="node" transform="translate(360,380)">
              <rect width="320" height="60" rx="10"></rect>
              <text x="12" y="36">Fallback A: â€Ups, widÅ¼et niedostÄ™pnyâ€</text>
            </g>

            <!-- Kolumna B -->
            <g class="node" transform="translate(740,70)">
              <rect width="320" height="60" rx="10"></rect>
              <text x="12" y="36">ErrorBoundary (Sekcja B)</text>
            </g>
            <path class="arrow" d="M900,130 L900,180" marker-end="url(#arr-eb2)" />
            <g class="pill" transform="translate(740,180)">
              <rect width="320" height="60" rx="10"></rect>
              <text x="12" y="36">B: &lt;List /&gt; (dziaÅ‚a)</text>
            </g>
            <path class="arrow" d="M900,240 L900,300" marker-end="url(#arr-eb2)" />
            <g class="pill" transform="translate(740,300)">
              <rect width="320" height="60" rx="10"></rect>
              <text x="12" y="36">B: &lt;Details /&gt; (dziaÅ‚a)</text>
            </g>

            <g transform="translate(40,440)">
              <foreignObject width="1000" height="50">
                <div xmlns="http://www.w3.org/1999/xhtml" class="muted">
                  BÅ‚Ä…d w Sekcji A nie wyÅ‚Ä…cza Sekcji B, Headera ani Footera â€“ kaÅ¼dy obszar z wÅ‚asnym boundary pozostaje niezaleÅ¼ny.
                </div>
              </foreignObject>
            </g>
          </g>
        </svg>
      </div>
    </details>

    <h2>Ograniczenia Error Boundaries</h2>
    <p>Error Boundaries dziaÅ‚ajÄ… tylko dla bÅ‚Ä™dÃ³w, ktÃ³re wystÄ™pujÄ… w czasie renderowania, w metodach cyklu Å¼ycia i w konstruktorze komponentu. Nie przechwytujÄ… bÅ‚Ä™dÃ³w wystÄ™pujÄ…cych w zdarzeniach asynchronicznych (np. <code>setTimeout</code>, <code>Promise</code>) ani w handlerach zdarzeÅ„ (te naleÅ¼y Å‚apaÄ‡ lokalnie). W takich przypadkach stosuj wÅ‚asne <code>try/catch</code>, <code>.catch()</code> i obsÅ‚ugÄ™ odrzuceÅ„.</p>

    <!-- WIZ 3: co boundary Å‚apie, a czego nie -->
    <details>
      <summary class="viz-title">ğŸ§­ Wizualizacja: Co Å‚apie Error Boundary, a czego nie</summary>
      <div class="viz-wrap">
        <svg viewBox="0 0 1100 520" class="viz-svg" aria-label="Boundary limitations">
          <defs>
            <marker id="arr-eb3" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
              <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
            </marker>
          </defs>

          <g class="lane" transform="translate(10,10)">
            <rect width="1080" height="500" rx="12"></rect>
            <text x="16" y="28" class="lane-title">Åapane vs nielapane</text>

            <!-- Kolumna: ÅAPANE -->
            <g class="ok" transform="translate(30,60)">
              <rect width="500" height="120" rx="10"></rect>
              <text x="12" y="28">âœ… ÅAPANE przez Error Boundary</text>
              <text x="12" y="52" class="muted">â€¢ BÅ‚Ä™dy podczas renderu</text>
              <text x="12" y="72" class="muted">â€¢ BÅ‚Ä™dy w lifecycle (componentDidMount/Update)</text>
              <text x="12" y="92" class="muted">â€¢ BÅ‚Ä™dy w konstruktorze komponentu</text>
            </g>

            <!-- Kolumna: NIEÅAPANE -->
            <g class="warn" transform="translate(560,60)">
              <rect width="500" height="120" rx="10"></rect>
              <text x="12" y="28">âŒ NIE ÅAPANE przez Error Boundary</text>
              <text x="12" y="52" class="muted">â€¢ BÅ‚Ä™dy w handlerach zdarzeÅ„ (onClick, onChange)</text>
              <text x="12" y="72" class="muted">â€¢ BÅ‚Ä™dy asynchroniczne (setTimeout, Promise)</text>
              <text x="12" y="92" class="muted">â€¢ BÅ‚Ä™dy poza React (np. w czystym kodzie poza drzewem)</text>
            </g>

            <g transform="translate(30,220)">
              <foreignObject width="1030" height="250">
                <div xmlns="http://www.w3.org/1999/xhtml" class="grid-two">
                  <table class="db-table">
                    <caption class="mini">Jak Å‚apaÄ‡ nielapane</caption>
                    <thead><tr><th>Sytuacja</th><th>Strategia</th></tr></thead>
                    <tbody>
                      <tr>
                        <td>Handler zdarzenia</td>
                        <td><code>try { ... } catch(e) { setError(e) }</code> i lokalny fallback UI</td>
                      </tr>
                      <tr>
                        <td>Promise / fetch</td>
                        <td><code>fetch(...).catch(e =&gt; setError(e))</code> lub <code>await</code> w <code>try/catch</code></td>
                      </tr>
                      <tr>
                        <td>Globalne nieobsÅ‚uÅ¼one</td>
                        <td><code>window.addEventListener('unhandledrejection', ...)</code> + raportowanie</td>
                      </tr>
                    </tbody>
                  </table>
                  <table class="db-table">
                    <caption class="mini">Dobre praktyki</caption>
                    <thead><tr><th>WskazÃ³wka</th><th>Dlaczego</th></tr></thead>
                    <tbody>
                      <tr><td>Boundary blisko ryzyka</td><td>Izoluje tylko wadliwy fragment UI</td></tr>
                      <tr><td>Fallback przyjazny</td><td>KrÃ³tki opis i opcja â€sprÃ³buj ponownieâ€</td></tr>
                      <tr><td>Loguj bÅ‚Ä™dy</td><td>Åatwiejsze debugowanie (Sentry, LogRocketâ€¦)</td></tr>
                    </tbody>
                  </table>
                </div>
              </foreignObject>
            </g>
          </g>
        </svg>
      </div>
    </details>

    <h2>PrzykÅ‚ad komponentu z bÅ‚Ä™dem</h2>
    <p>Aby zobaczyÄ‡ Error Boundary w akcji, poniÅ¼ej znajduje siÄ™ przykÅ‚ad komponentu, ktÃ³ry celowo wyrzuca bÅ‚Ä…d:</p>

<pre><code class="language-javascript">
// FaultyComponent.js
import React from 'react';

function FaultyComponent() {
  throw new Error("Ups! WystÄ…piÅ‚ bÅ‚Ä…d.");
}

export default FaultyComponent;
</code></pre>

    <p>Gdy <code>FaultyComponent</code> zostanie zaÅ‚adowany w <code>ErrorBoundary</code>, komunikat bÅ‚Ä™du zostanie wyÅ›wietlony bez przerywania dziaÅ‚ania reszty aplikacji.</p>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-javascript.min.js"></script>

  <!-- STYLE: responsywne wizualizacje i peÅ‚na szerokoÅ›Ä‡ -->
  <style>
    /* bloki wizualizacji */
    details, .viz-wrap { width:100%; max-width:none !important; }
    .viz-title{cursor:pointer;font-weight:600}
    .viz-wrap{padding:.5rem .25rem}

    /* SVG peÅ‚na szerokoÅ›Ä‡ */
    .viz-svg{display:block;width:100% !important;max-width:100% !important;height:auto !important;background:#0e1729;border-radius:12px}

    /* schemat kolorÃ³w */
    .lane rect{fill:#0f172a;stroke:#1f2937}
    .lane-title{fill:#cbd5e1;font-weight:600}
    .node rect{fill:#111827;stroke:#334155}
    .pill rect{fill:#0b3b2e;stroke:#14532d}
    .ok rect{fill:#0b2a3b;stroke:#0e7490}
    .warn rect{fill:#3b0b0b;stroke:#7f1d1d}
    .node text,.pill text,.ok text,.warn text{fill:#e2e8f0;font-size:14px}
    .muted{fill:#94a3b8;font-size:12px}
    .arrow{stroke:#94a3b8;stroke-width:2;fill:none}

    /* tabele i layout */
    .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
    @media (max-width: 900px){.grid-two{grid-template-columns:1fr}}
    .db-table{width:100% !important;max-width:100% !important;border-collapse:collapse;margin:.5rem 0;table-layout:fixed}
    .db-table th,.db-table td{border:1px solid #aeaeae;padding:.5rem .65rem;text-align:left;vertical-align:top;word-break:break-word}
    .db-table th{background:#0e1729;color:#dbe2ea}
    .mini{color:#a7b0be;font-size:.95rem}

    /* kod â€“ peÅ‚na szerokoÅ›Ä‡ + scroll poziomy, gdy trzeba */
    pre[class*="language-"]{width:100% !important;max-width:none !important;box-sizing:border-box;overflow-x:auto;white-space:pre}
    code[class*="language-"]{white-space:pre}
  </style>
</body>
</html>
