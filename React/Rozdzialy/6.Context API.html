<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React - Context API</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <h1>React - Context API</h1>
        
        <p>Context API to mechanizm Reacta, który pozwala przekazywać dane w drzewie komponentów bez potrzeby przekazywania ich ręcznie za pomocą <code>props</code> (ang. prop drilling). Jest przydatny, gdy mamy wiele komponentów zależnych od wspólnego kontekstu, takich jak ustawienia użytkownika, temat aplikacji itp.</p>

        <h2>Tworzenie Kontekstu</h2>
        <p>Aby użyć Context API, najpierw tworzymy kontekst przy użyciu funkcji <code>React.createContext</code>. Możemy zdefiniować wartość domyślną dla kontekstu, która będzie dostępna, jeśli nie zostanie ustawiona żadna inna wartość.</p>

        <pre><code class="language-javascript">
import React, { createContext } from 'react';

// Tworzenie kontekstu z wartością domyślną "jasny" dla tematu
const ThemeContext = createContext('jasny');

export default ThemeContext;
        </code></pre>

        <!-- Wizualizacja: createContext -->
        <details open>
          <summary class="viz-title">🧩 Wizualizacja: <code>createContext</code> (wartość domyślna i Provider)</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 360" class="viz-svg" aria-label="Diagram createContext">
              <defs>
                <marker id="arr1" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="340" rx="12"></rect>
                <text x="16" y="28" class="lane-title">createContext('jasny') → Provider może nadpisać wartość</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="280" height="70" rx="10"></rect>
                  <text x="12" y="26">ThemeContext</text>
                  <text x="12" y="48" class="muted">default = 'jasny'</text>
                </g>

                <path d="M300,95 L420,95" class="arrow"/>
                <g class="pill" transform="translate(420,60)">
                  <rect width="260" height="70" rx="10"></rect>
                  <text x="12" y="26">&lt;ThemeContext.Provider value="ciemny"&gt;</text>
                  <text x="12" y="48" class="muted">nadpisuje default</text>
                </g>

                <path d="M680,95 L880,95" class="arrow"/>
                <g class="ok" transform="translate(740,60)">
                  <rect width="220" height="70" rx="10"></rect>
                  <text x="12" y="26">Consumer / useContext</text>
                  <text x="12" y="48" class="muted">widzi 'ciemny'</text>
                </g>

                <g class="warn" transform="translate(20,160)">
                  <rect width="940" height="70" rx="10"></rect>
                  <text x="12" y="26">Brak Providera?</text>
                  <text x="12" y="48" class="muted">Consumer zobaczy wartość domyślną: 'jasny'</text>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">Kiedy tworzyć osobne contexty?</caption>
                <thead><tr><th>Przypadek</th><th>Powód</th></tr></thead>
                <tbody>
                  <tr><td>Temat + język + user</td><td>unikasz zbędnych re-renderów przy zmianie jednego z nich</td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Wartość domyślna</caption>
                <thead><tr><th>Sytuacja</th><th>Wartość</th></tr></thead>
                <tbody>
                  <tr><td>Brak Provider</td><td>użyta zostanie wartość z <code>createContext(default)</code></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>

        <h2>Provider - Dostarczanie Danych</h2>
        <p>Komponent <code>Provider</code> udostępnia wartość kontekstu wszystkim komponentom podrzędnym. Wartość kontekstu można ustawić za pomocą atrybutu <code>value</code> na <code>Provider</code>.</p>

        <pre><code class="language-javascript">
import React from 'react';
import ThemeContext from './ThemeContext';

function App() {
    return (
        &lt;ThemeContext.Provider value="ciemny"&gt;
            &lt;Toolbar /&gt;
        &lt;/ThemeContext.Provider&gt;
    );
}
        </code></pre>

        <!-- Wizualizacja: Provider z drzewem -->
        <details>
          <summary class="viz-title">🌳 Wizualizacja: Provider → propagacja wartości w drzewie</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 520" class="viz-svg" aria-label="Diagram Provider">
              <defs>
                <marker id="arr2" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="500" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Provider otacza poddrzewo — wszystkie dzieci widzą tę samą wartość</text>

                <!-- Provider box -->
                <g transform="translate(20,60)">
                  <rect width="940" height="420" rx="12" fill="none" stroke="#0ea5e9" stroke-dasharray="8 6" />
                  <text x="12" y="26" class="muted">ThemeContext.Provider value="ciemny"</text>

                  <!-- Tree -->
                  <g transform="translate(30,50)">
                    <g class="node">
                      <rect width="200" height="60" rx="10"></rect>
                      <text x="12" y="24">App</text>
                      <text x="12" y="44" class="muted">root</text>
                    </g>

                    <path d="M100,60 L100,110" class="arrow2"/>
                    <g class="node" transform="translate(-40,110)">
                      <rect width="280" height="60" rx="10"></rect>
                      <text x="12" y="24">Toolbar</text>
                      <text x="12" y="44" class="muted">dziecko</text>
                    </g>

                    <path d="M100,170 L-40,230" class="arrow2"/>
                    <g class="ok" transform="translate(-120,230)">
                      <rect width="220" height="60" rx="10"></rect>
                      <text x="12" y="24">Button</text>
                      <text x="12" y="44" class="muted">theme = 'ciemny'</text>
                    </g>

                    <path d="M100,170 L180,230" class="arrow2"/>
                    <g class="ok" transform="translate(100,230)">
                      <rect width="260" height="60" rx="10"></rect>
                      <text x="12" y="24">Badge</text>
                      <text x="12" y="44" class="muted">theme = 'ciemny'</text>
                    </g>
                  </g>
                </g>

                <g class="warn" transform="translate(20,480)">
                  <rect width="0" height="0" rx="10"></rect>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">Zmiana value → re-render</caption>
                <thead><tr><th>Zdarzenie</th><th>Efekt</th></tr></thead>
                <tbody>
                  <tr><td>Provider: value zmienia się</td><td>WSZYSCY konsumenci w zasięgu renderują się ponownie</td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Optymalizacja</caption>
                <thead><tr><th>Technika</th><th>Idea</th></tr></thead>
                <tbody>
                  <tr><td>Dzielenie contextów</td><td>np. osobno Theme i User</td></tr>
                  <tr><td>Stabilna referencja</td><td>memoizuj value: <code>useMemo(() =&gt; ({theme}), [theme])</code></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>

        <h2>Consumer - Pobieranie Danych</h2>
        <p>Wewnętrzne komponenty mogą uzyskać dostęp do kontekstu za pomocą komponentu <code>Consumer</code> lub hooka <code>useContext</code>. <code>Consumer</code> wykorzystuje funkcję renderującą, aby uzyskać dostęp do wartości kontekstu.</p>

        <pre><code class="language-javascript">
import React from 'react';
import ThemeContext from './ThemeContext';

function Toolbar() {
    return (
        &lt;ThemeContext.Consumer&gt;
            {theme => &lt;button className={theme}&gt;Motyw: {theme}&lt;/button&gt;}
        &lt;/ThemeContext.Consumer&gt;
    );
}
        </code></pre>

        <!-- Wizualizacja: Consumer -->
        <details>
          <summary class="viz-title">🎛️ Wizualizacja: <code>Consumer</code> (funkcja renderująca)</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 380" class="viz-svg" aria-label="Diagram Consumer">
              <defs>
                <marker id="arr3" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="360" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Provider → Consumer({theme}) → UI</text>

                <g class="pill" transform="translate(20,60)">
                  <rect width="300" height="70" rx="10"></rect>
                  <text x="12" y="26">Provider value="ciemny"</text>
                  <text x="12" y="48" class="muted">źródło</text>
                </g>

                <path d="M320,95 L480,95" class="arrow"/>
                <g class="node" transform="translate(480,60)">
                  <rect width="300" height="70" rx="10"></rect>
                  <text x="12" y="26">Consumer</text>
                  <text x="12" y="48" class="muted">{theme =&gt; ...}</text>
                </g>

                <path d="M780,95 L920,95" class="arrow"/>
                <g class="ok" transform="translate(780,160)">
                  <rect width="180" height="60" rx="10"></rect>
                  <text x="12" y="24">&lt;button class="ciemny"&gt;</text>
                  <text x="12" y="44" class="muted">render UI</text>
                </g>

                <g class="warn" transform="translate(20,160)">
                  <rect width="740" height="60" rx="10"></rect>
                  <text x="12" y="24">Zmiana value</text>
                  <text x="12" y="44" class="muted">Consumer renderuje się ponownie</text>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">Plusy / minusy</caption>
                <thead><tr><th>Aspekt</th><th>Opis</th></tr></thead>
                <tbody>
                  <tr><td>Elastyczność</td><td>pełna kontrola w funkcji renderującej</td></tr>
                  <tr><td>Wczytywanie</td><td>gniazdowanie Consumerów bywa nieczytelne</td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Praktyka</caption>
                <thead><tr><th>Wzorzec</th><th>Dlaczego</th></tr></thead>
                <tbody>
                  <tr><td>Preferuj hook</td><td><code>useContext</code> prostszy w funkcjonalnych</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>

        <h2>useContext Hook</h2>
        <p>Alternatywnie można użyć hooka <code>useContext</code> do pobrania wartości kontekstu bez używania <code>Consumer</code>. Jest to wygodniejsze, zwłaszcza w komponentach funkcyjnych.</p>

        <pre><code class="language-javascript">
import React, { useContext } from 'react';
import ThemeContext from './ThemeContext';

function Toolbar() {
    const theme = useContext(ThemeContext);
    
    return &lt;button className={theme}&gt;Motyw: {theme}&lt;/button&gt;;
}
        </code></pre>

        <!-- Wizualizacja: useContext -->
        <details>
          <summary class="viz-title">⚡ Wizualizacja: <code>useContext</code> (prosty odczyt + re-render)</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 420" class="viz-svg" aria-label="Diagram useContext">
              <defs>
                <marker id="arr4" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="400" rx="12"></rect>
                <text x="16" y="28" class="lane-title">useContext(ThemeContext) → zwraca bieżącą wartość</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="330" height="70" rx="10"></rect>
                  <text x="12" y="26">const theme = useContext(ThemeContext)</text>
                  <text x="12" y="48" class="muted">odczyt wartości</text>
                </g>

                <path d="M350,95 L520,95" class="arrow"/>
                <g class="ok" transform="translate(520,60)">
                  <rect width="220" height="70" rx="10"></rect>
                  <text x="12" y="26">theme = 'ciemny'</text>
                  <text x="12" y="48" class="muted">przykład</text>
                </g>

                <path d="M740,95 L900,95" class="arrow"/>
                <g class="pill" transform="translate(740,60)">
                  <rect width="240" height="70" rx="10"></rect>
                  <text x="12" y="26">Render UI</text>
                  <text x="12" y="48" class="muted">klasa/kolory wg theme</text>
                </g>

                <g class="warn" transform="translate(20,160)">
                  <rect width="940" height="70" rx="10"></rect>
                  <text x="12" y="26">Zmiana Provider.value</text>
                  <text x="12" y="48" class="muted">komponent z useContext renderuje się ponownie</text>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">Optymalizacja</caption>
                <thead><tr><th>Technika</th><th>Opis</th></tr></thead>
                <tbody>
                  <tr><td>Rozbij Provider</td><td>mniejsze zakresy aktualizacji</td></tr>
                  <tr><td>Memoizuj value</td><td><code>useMemo</code> dla stabilnej referencji</td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Pułapki</caption>
                <thead><tr><th>Problem</th><th>Skutek</th></tr></thead>
                <tbody>
                  <tr><td>Value tworzone inline</td><td>każdy render → nowa referencja → zbędne re-rendery</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-javascript.min.js"></script>

    <!-- Izolowany CSS dla wizualizacji: pełna szerokość + responsywność -->
    <style>
      /* Pełna szerokość w obrębie .container */
      details, .viz-wrap { width: 100%; max-width: none !important; }
      .viz-title{cursor:pointer;font-weight:600}
      .viz-wrap{padding:.5rem .25rem}

      /* SVG responsywne */
      .viz-svg{display:block;width:100% !important;max-width:100% !important;height:auto !important;background:#0e1729;border-radius:12px}

      /* Siatka i tabelki */
      .grid-two{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:.75rem;width:100%;max-width:none}
      .grid-two>*{min-width:0}
      @media (max-width: 900px){.grid-two{grid-template-columns:1fr}}
      .db-table{width:100% !important;max-width:100% !important;border-collapse:collapse;margin:.5rem 0;table-layout:fixed}
      .db-table th,.db-table td{border:1px solid #aeaeae;padding:.5rem .65rem;text-align:left;vertical-align:top;word-break:break-word}
      .db-table th{background:#0e1729;color:#dbe2ea}
      .mini{color:#a7b0be;font-size:.95rem}

      /* Kafelki / kolory */
      .lane rect{fill:#0f172a;stroke:#1f2937}
      .lane-title{fill:#cbd5e1;font-weight:600}
      .node rect{fill:#111827;stroke:#334155}
      .pill rect{fill:#0b3b2e;stroke:#14532d}
      .ok rect{fill:#0b2a3b;stroke:#0e7490}
      .warn rect{fill:#3b0b0b;stroke:#7f1d1d}
      .node text,.pill text,.ok text,.warn text{fill:#e2e8f0;font-size:14px}
      .muted{fill:#94a3b8;font-size:12px}

      /* Strzałki */
      .arrow,.arrow2{stroke:#94a3b8;stroke-width:2;fill:none}
      .arrow{marker-end:url(#arr1)}
      .arrow2{marker-end:url(#arr2)}

      /* Kod – pełna szerokość + przewijanie */
      pre[class*="language-"]{width:100% !important;max-width:none !important;box-sizing:border-box;overflow-x:auto;white-space:pre}
      code[class*="language-"]{white-space:pre}
    </style>
</body>
</html>
