<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React - Metody Cyklu ≈ªycia</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">
        <h1>React - Metody Cyklu ≈ªycia</h1>
        
        <p>Komponenty klasowe w React posiadajƒÖ zestaw metod cyklu ≈ºycia, kt√≥re pozwalajƒÖ kontrolowaƒá zachowanie komponentu w okre≈õlonych momentach jego istnienia. Metody te sƒÖ szczeg√≥lnie przydatne do wykonywania akcji w momencie montowania, aktualizowania oraz odmontowywania komponentu.</p>

        <h2>Podstawowe Metody Cyklu ≈ªycia</h2>

        <h3><code>componentDidMount</code></h3>
        <p>Metoda <code>componentDidMount</code> jest wywo≈Çywana po zamontowaniu komponentu w drzewie DOM. Jest u≈ºywana do inicjowania akcji, takich jak pobieranie danych z API, ustawianie timer√≥w itp.</p>
        
        <pre><code class="language-javascript">
import React, { Component } from 'react';

class ExampleComponent extends Component {
    componentDidMount() {
        console.log("Komponent zosta≈Ç zamontowany!");
        // Mo≈ºna tu wywo≈Çaƒá np. fetch() aby pobraƒá dane
    }

    render() {
        return &lt;h1&gt;Witaj, ≈õwiecie!&lt;/h1&gt;;
    }
}
        </code></pre>

        <!-- Wizualizacja: componentDidMount -->
        <details open>
          <summary class="viz-title">üß© Wizualizacja: Montowanie ‚Üí <code>componentDidMount</code></summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 380" class="viz-svg" aria-label="Diagram componentDidMount">
              <defs>
                <marker id="arrowMount" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="360" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Mounting: constructor ‚Üí render ‚Üí commit ‚Üí componentDidMount</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="280" height="60" rx="10"></rect>
                  <text x="12" y="24">constructor(props)</text>
                  <text x="12" y="44" class="muted">inicjalizacja stanu</text>
                </g>

                <path d="M300,90 L360,90" class="arrowM"/>
                <g class="node" transform="translate(360,60)">
                  <rect width="260" height="60" rx="10"></rect>
                  <text x="12" y="24">render()</text>
                  <text x="12" y="44" class="muted">tworzy wirtualny DOM</text>
                </g>

                <path d="M620,90 L680,90" class="arrowM"/>
                <g class="ok" transform="translate(680,60)">
                  <rect width="290" height="60" rx="10"></rect>
                  <text x="12" y="24">commit do DOM</text>
                  <text x="12" y="44" class="muted">UI widoczne</text>
                </g>

                <path d="M170,170 L830,170" class="arrowM"/>
                <g class="pill" transform="translate(260,140)">
                  <rect width="480" height="60" rx="10"></rect>
                  <text x="12" y="24">componentDidMount()</text>
                  <text x="12" y="44" class="muted">start efekt√≥w: fetch/timer/subskrypcja</text>
                </g>

                <g class="warn" transform="translate(260,240)">
                  <rect width="480" height="60" rx="10"></rect>
                  <text x="12" y="24">Uwaga</text>
                  <text x="12" y="44" class="muted">setState tutaj ‚Üí kolejny render</text>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">Co robiƒá?</caption>
                <thead><tr><th>Akcja</th><th>Dlaczego</th></tr></thead>
                <tbody>
                  <tr><td>fetch/subscribe</td><td>elementy DOM ju≈º sƒÖ</td></tr>
                  <tr><td>setInterval</td><td>timer dzia≈Ça po pokazaniu UI</td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Czego unikaƒá?</caption>
                <thead><tr><th>Anty-wzorzec</th><th>Skutek</th></tr></thead>
                <tbody>
                  <tr><td>Ciƒô≈ºkie obliczenia</td><td>UI pojawi siƒô p√≥≈∫niej</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>

        <h3><code>componentDidUpdate</code></h3>
        <p>Metoda <code>componentDidUpdate</code> jest wywo≈Çywana po ka≈ºdej aktualizacji komponentu, gdy zmieniƒÖ siƒô jego <code>props</code> lub <code>state</code>. Mo≈ºna jej u≈ºywaƒá do reagowania na te zmiany, na przyk≈Çad aktualizujƒÖc dane lub zmieniajƒÖc DOM.</p>

        <pre><code class="language-javascript">
class ExampleComponent extends Component {
    componentDidUpdate(prevProps, prevState) {
        console.log("Komponent zosta≈Ç zaktualizowany!");

        if (this.props.someValue !== prevProps.someValue) {
            // Wykonaj akcjƒô, gdy someValue siƒô zmieni
        }
    }

    render() {
        return &lt;h1&gt;Witaj, ≈õwiecie!&lt;/h1&gt;;
    }
}
        </code></pre>

        <!-- Wizualizacja: componentDidUpdate -->
        <details>
          <summary class="viz-title">üîÅ Wizualizacja: Aktualizacja ‚Üí <code>componentDidUpdate</code></summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 420" class="viz-svg" aria-label="Diagram componentDidUpdate">
              <defs>
                <marker id="arrowUpdate" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="400" rx="12"></rect>
                <text x="16" y="28" class="lane-title">setState/nowe props ‚Üí render ‚Üí commit ‚Üí componentDidUpdate</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="300" height="60" rx="10"></rect>
                  <text x="12" y="24">Zmiana state/props</text>
                  <text x="12" y="44" class="muted">np. setState()</text>
                </g>

                <path d="M320,90 L380,90" class="arrowU"/>
                <g class="node" transform="translate(380,60)">
                  <rect width="240" height="60" rx="10"></rect>
                  <text x="12" y="24">render()</text>
                  <text x="12" y="44" class="muted">nowy wirtualny DOM</text>
                </g>

                <path d="M620,90 L680,90" class="arrowU"/>
                <g class="ok" transform="translate(680,60)">
                  <rect width="290" height="60" rx="10"></rect>
                  <text x="12" y="24">commit</text>
                  <text x="12" y="44" class="muted">aktualizacja DOM</text>
                </g>

                <g class="pill" transform="translate(20,160)">
                  <rect width="950" height="60" rx="10"></rect>
                  <text x="12" y="24">componentDidUpdate(prevProps, prevState)</text>
                  <text x="12" y="44" class="muted">reakcja po renderze</text>
                </g>

                <g class="warn" transform="translate(20,240)">
                  <rect width="950" height="60" rx="10"></rect>
                  <text x="12" y="24">Uwaga na zapƒôtlenia</text>
                  <text x="12" y="44" class="muted">setState bez warunku ‚Üí niesko≈Ñczona pƒôtla</text>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">Dobre praktyki</caption>
                <thead><tr><th>Wzorzec</th><th>Opis</th></tr></thead>
                <tbody>
                  <tr><td>Por√≥wnuj prevProps/prevState</td><td>warunkuj setState/akcje</td></tr>
                  <tr><td>Efekty uboczne po commit</td><td>DOM ju≈º zaktualizowany</td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Przyk≈Çady u≈ºycia</caption>
                <thead><tr><th>Sytuacja</th><th>Akcja</th></tr></thead>
                <tbody>
                  <tr><td>Zmiana ID</td><td>pobierz nowe dane</td></tr>
                  <tr><td>Zmiana rozmiaru</td><td>przelicz layout</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>

        <h3><code>componentWillUnmount</code></h3>
        <p>Metoda <code>componentWillUnmount</code> jest wywo≈Çywana tu≈º przed odmontowaniem komponentu z DOM. U≈ºywana jest do czyszczenia zasob√≥w, takich jak anulowanie timer√≥w lub zako≈Ñczenie nas≈Çuch√≥w zdarze≈Ñ.</p>

        <pre><code class="language-javascript">
class ExampleComponent extends Component {
    componentWillUnmount() {
        console.log("Komponent zostanie odmontowany!");
        // Mo≈ºna tu np. usunƒÖƒá timer lub nas≈Çuch zdarze≈Ñ
    }

    render() {
        return &lt;h1&gt;Witaj, ≈õwiecie!&lt;/h1&gt;;
    }
}
        </code></pre>

        <!-- Wizualizacja: componentWillUnmount -->
        <details>
          <summary class="viz-title">üßπ Wizualizacja: Odmontowanie ‚Üí <code>componentWillUnmount</code></summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 320" class="viz-svg" aria-label="Diagram componentWillUnmount">
              <defs>
                <marker id="arrowUnmount" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="300" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Unmounting: usuwanie z DOM ‚Üí cleanup</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="360" height="60" rx="10"></rect>
                  <text x="12" y="24">Rozpoczƒôcie odmontowania</text>
                  <text x="12" y="44" class="muted">komponent znika z UI</text>
                </g>

                <path d="M380,90 L460,90" class="arrowUM"/>
                <g class="pill" transform="translate(460,60)">
                  <rect width="280" height="60" rx="10"></rect>
                  <text x="12" y="24">componentWillUnmount()</text>
                  <text x="12" y="44" class="muted">usu≈Ñ timery/subskrypcje</text>
                </g>

                <path d="M740,90 L820,90" class="arrowUM"/>
                <g class="ok" transform="translate(820,60)">
                  <rect width="170" height="60" rx="10"></rect>
                  <text x="12" y="24">DOM -</text>
                  <text x="12" y="44" class="muted">poza drzewem</text>
                </g>

                <g class="warn" transform="translate(20,160)">
                  <rect width="950" height="60" rx="10"></rect>
                  <text x="12" y="24">Uwaga</text>
                  <text x="12" y="44" class="muted">wycieki pamiƒôci, gdy nie wyczy≈õcisz</text>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">Czy≈õƒá zawsze</caption>
                <thead><tr><th>Co</th><th>Jak</th></tr></thead>
                <tbody>
                  <tr><td>Timer</td><td><code>clearInterval</code></td></tr>
                  <tr><td>Event listener</td><td><code>removeEventListener</code></td></tr>
                  <tr><td>Subskrypcja</td><td><code>unsubscribe</code></td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Objawy braku cleanup</caption>
                <thead><tr><th>Objaw</th><th>Przyczyna</th></tr></thead>
                <tbody>
                  <tr><td>B≈Çƒôdy ‚ÄûsetState on unmounted‚Äù</td><td>timer/subskrypcja ≈ºyje dalej</td></tr>
                  <tr><td>Wysokie zu≈ºycie CPU</td><td>nieusuniƒôte interwa≈Çy</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>

        <h2>Przyk≈Çad: Timer z Metodami Cyklu ≈ªycia</h2>
        <p>Poni≈ºszy przyk≈Çad demonstruje u≈ºycie metod <code>componentDidMount</code> i <code>componentWillUnmount</code> do ustawienia i czyszczenia timera w komponencie klasowym.</p>

        <pre><code class="language-javascript">
class Timer extends Component {
    // Konstruktor klasy, w kt√≥rym ustawiany jest poczƒÖtkowy stan komponentu
    constructor(props) {
        super(props); // Wywo≈Çanie konstruktora klasy nadrzƒôdnej (Component)
        this.state = { time: new Date() }; // Ustawienie poczƒÖtkowego stanu z aktualnƒÖ datƒÖ i czasem
    }

    // Funkcja wykonywana automatycznie po zamontowaniu komponentu
    componentDidMount() {
        // Ustawienie interwa≈Çu, kt√≥ry co 1000 ms (1 sekunda) wywo≈Çuje metodƒô tick()
        this.timerID = setInterval(() => this.tick(), 1000);
    }

    // Funkcja wykonywana automatycznie przed usuniƒôciem komponentu
    componentWillUnmount() {
        // Wyczyszczenie interwa≈Çu, aby zatrzymaƒá wywo≈Çywanie tick() po usuniƒôciu komponentu
        clearInterval(this.timerID);
    }

    // Metoda tick aktualizuje stan z aktualnƒÖ datƒÖ i czasem
    tick() {
        this.setState({ time: new Date() }); // Ustawienie nowego czasu w stanie komponentu
    }

    // Metoda renderujƒÖca JSX do wy≈õwietlenia na stronie
    render() {
        // Zwraca element <h2> z tekstem i aktualnym czasem pobranym ze stanu
        return <h2>Aktualna godzina: {this.state.time.toLocaleTimeString()}</h2>;
    }
}
        </code></pre>
        
        <!-- Wizualizacja: Timer -->
        <details>
          <summary class="viz-title">‚è≤Ô∏è Wizualizacja: Timer ‚Äì mount ‚Üí tick ‚Üí unmount</summary>
          <div class="viz-wrap">
            <svg viewBox="0 0 1000 460" class="viz-svg" aria-label="Diagram timera">
              <defs>
                <marker id="arrowTimer" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                  <path d="M0,0 L12,6 L0,12 Z" fill="#94a3b8"></path>
                </marker>
              </defs>

              <g class="lane" transform="translate(10,10)">
                <rect width="980" height="440" rx="12"></rect>
                <text x="16" y="28" class="lane-title">Mount ‚Üí uruchom interval ‚Üí co 1s setState ‚Üí render ‚Üí Unmount ‚Üí clearInterval</text>

                <g class="node" transform="translate(20,60)">
                  <rect width="270" height="60" rx="10"></rect>
                  <text x="12" y="24">componentDidMount()</text>
                  <text x="12" y="44" class="muted">start setInterval</text>
                </g>

                <path d="M290,90 L360,90" class="arrowT"/>
                <g class="ok" transform="translate(360,60)">
                  <rect width="250" height="60" rx="10"></rect>
                  <text x="12" y="24">tick() co 1s</text>
                  <text x="12" y="44" class="muted">this.setState({time:...})</text>
                </g>

                <path d="M610,90 L680,90" class="arrowT"/>
                <g class="pill" transform="translate(680,60)">
                  <rect width="290" height="60" rx="10"></rect>
                  <text x="12" y="24">render()</text>
                  <text x="12" y="44" class="muted">UI: aktualna godzina</text>
                </g>

                <g class="warn" transform="translate(20,160)">
                  <rect width="950" height="70" rx="10"></rect>
                  <text x="12" y="28">componentWillUnmount()</text>
                  <text x="12" y="50" class="muted">clearInterval(this.timerID)</text>
                </g>

                <g class="node" transform="translate(20,260)">
                  <rect width="950" height="60" rx="10"></rect>
                  <text x="12" y="24">Po unmount: brak dalszych tick()</text>
                  <text x="12" y="44" class="muted">koniec aktualizacji</text>
                </g>
              </g>
            </svg>

            <div class="grid-two">
              <table class="db-table">
                <caption class="mini">O≈õ czasu (sekundy)</caption>
                <thead><tr><th>t</th><th>Zdarzenie</th><th>UI</th></tr></thead>
                <tbody>
                  <tr><td>t=0</td><td>mount ‚Üí start interval</td><td>pokazuje czas</td></tr>
                  <tr><td>t=1</td><td>tick ‚Üí setState</td><td>nowy czas</td></tr>
                  <tr><td>t=2</td><td>tick ‚Üí setState</td><td>nowy czas</td></tr>
                  <tr><td>‚Ä¶</td><td>‚Ä¶</td><td>‚Ä¶</td></tr>
                  <tr><td>t=n</td><td>unmount ‚Üí clearInterval</td><td>brak dalszych zmian</td></tr>
                </tbody>
              </table>
              <table class="db-table">
                <caption class="mini">Typowe pu≈Çapki</caption>
                <thead><tr><th>Problem</th><th>Naprawa</th></tr></thead>
                <tbody>
                  <tr><td>zostawiony interval</td><td>wyczy≈õƒá w <code>componentWillUnmount</code></td></tr>
                  <tr><td>kilka intervali</td><td>trzymaj id w <code>this.timerID</code>, nie dubluj</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </details>
        
        <p>W tym przyk≈Çadzie <code>componentDidMount</code> ustawia timer, kt√≥ry aktualizuje czas co sekundƒô, a <code>componentWillUnmount</code> usuwa ten timer, gdy komponent jest odmontowywany.</p>

        <h2>Podsumowanie</h2>
        <!-- Montowanie -->
        <p><strong>Montowanie (Mounting):</strong></p>
        <ul>
          <li>Wywo≈Çywane, gdy komponent jest dodawany do DOM.</li>
          <li>Przyk≈Çadowa metoda: <code>componentDidMount</code>.</li>
        </ul>

        <!-- Aktualizowanie -->
        <p><strong>Aktualizowanie (Updating):</strong></p>
        <ul>
          <li>Wywo≈Çywane, gdy komponent otrzymuje nowe props lub zmienia siƒô jego state.</li>
          <li>Przyk≈Çadowa metoda: <code>componentDidUpdate</code>.</li>
        </ul>

        <!-- Odmontowanie -->
        <p><strong>Odmontowanie (Unmounting):</strong></p>
        <ul>
          <li>Wywo≈Çywane, gdy komponent jest usuwany z DOM.</li>
          <li>Przyk≈Çadowa metoda: <code>componentWillUnmount</code>.</li>
        </ul>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-javascript.min.js"></script>

    <!-- Izolowany CSS dla wizualizacji: pe≈Çna szeroko≈õƒá + responsywno≈õƒá -->
    <style>
      /* pe≈Çna szeroko≈õƒá w obrƒôbie .container */
      details, .viz-wrap { width: 100%; max-width: none !important; }
      .viz-svg{display:block;width:100% !important;max-width:100% !important;height:auto !important;background:#0e1729;border-radius:12px}

      /* Tytu≈Çy i wrapper */
      .viz-title{cursor:pointer;font-weight:600}
      .viz-wrap{padding:.5rem .25rem}

      /* Siatka i tabelki */
      .grid-two{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:.75rem;width:100%;max-width:none}
      .grid-two>*{min-width:0}
      @media (max-width: 900px){.grid-two{grid-template-columns:1fr}}
      .db-table{width:100% !important;max-width:100% !important;border-collapse:collapse;margin:.5rem 0;table-layout:fixed}
      .db-table th,.db-table td{border:1px solid #aeaeae;padding:.5rem .65rem;text-align:left;vertical-align:top;word-break:break-word}
      .db-table th{background:#0e1729;color:#dbe2ea}
      .mini{color:#a7b0be;font-size:.95rem}

      /* Styl kafelk√≥w w SVG */
      .lane rect{fill:#0f172a;stroke:#1f2937}
      .lane-title{fill:#cbd5e1;font-weight:600}
      .node rect{fill:#111827;stroke:#334155}
      .pill rect{fill:#0b3b2e;stroke:#14532d}
      .ok rect{fill:#0b2a3b;stroke:#0e7490}
      .warn rect{fill:#3b0b0b;stroke:#7f1d1d}
      .node text,.pill text,.ok text,.warn text{fill:#e2e8f0;font-size:14px}
      .muted{fill:#94a3b8;font-size:12px}

      /* Strza≈Çki */
      .arrowM,.arrowU,.arrowUM,.arrowT{stroke:#94a3b8;stroke-width:2;fill:none}
      .arrowM{marker-end:url(#arrowMount)}
      .arrowU{marker-end:url(#arrowUpdate)}
      .arrowUM{marker-end:url(#arrowUnmount)}
      .arrowT{marker-end:url(#arrowTimer)}

      /* Kod ‚Äì pe≈Çna szeroko≈õƒá + przewijanie */
      pre[class*="language-"]{width:100% !important;max-width:none !important;box-sizing:border-box;overflow-x:auto;white-space:pre}
      code[class*="language-"]{white-space:pre}
    </style>
</body>
</html>
